<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eG Alarm Analysis Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	
	<style>
	    body { 
	        font-family: Arial, Tahoma, Geneva, Verdana, sans-serif; 
	        background-color: #f5f7fa; 
	    }
	    .header-section { 
	        background: linear-gradient(135deg, #474747 0%, #ffffff 100%); 
	        color: white; 
	        padding: 40px 0; 
	        margin-bottom: 30px; 
	    }
	    .header-section h1 { 
	        font-weight: 600; 
	        margin-bottom: 10px; 
	    }
	    .header-section .subtitle { 
	        opacity: 0.9; 
	        font-size: 1.1rem; 
	    }
	    .alarm-card { 
	        margin-bottom: 30px; 
	        border: none; 
	        box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
	    }
	    .alarm-card .card-header { 
	        background-color: #474747; 
	        color: white; 
	        font-weight: 500; 
	        padding: 15px 20px; 
	    }
	    .alarm-card .card-body { 
	        padding: 25px; 
	    }
	    .badge-repeat { 
	        background-color: #dc3545; 
	        font-size: 0.85rem; 
	        margin-left: 10px; 
	    }
	    .priority-major { 
	        border-left: 5px solid #fa9d1c; 
	    }
	    .priority-critical { 
	        border-left: 5px solid #cd0f0f; 
	    }
	    .priority-minor { 
	        border-left: 5px solid #ccc100; 
	    }
	    .section-title { 
	        color: #F29305; 
	        font-weight: 600; 
	        margin-top: 20px; 
	        margin-bottom: 10px; 
	        border-bottom: 2px solid #e9ecef; 
	        padding-bottom: 5px; 
	    }
	    .metric-image { 
	        max-width: 100%; 
	        height: auto; 
	        border: 1px solid #dee2e6; 
	        border-radius: 4px; 
	        margin: 15px 0; 
	    }
	    .interpretation-box { 
	        background-color: #f8f9fa; 
	        padding: 15px; 
	        border-radius: 4px; 
	        margin: 15px 0; 
	    }
	    .ai-analysis { 
	        background-color: #ededed; 
	        padding: 20px; 
	        border-radius: 4px; 
	        margin: 15px 0; 
	        border-left: 4px solid #F29305; 
	    }
	    .footer-section { 
	        background-color: #1e3a8a; 
	        color: white; 
	        padding: 30px 0; 
	        margin-top: 50px; 
	    }
	    .caveat-box { 
	        background-color: #fff3cd; 
	        border: 1px solid #ffc107; 
	        padding: 15px; 
	        border-radius: 4px; 
	        margin: 20px 0; 
	    }
	    .detail-table { 
	        font-size: 0.9rem; 
	    }
	    .detail-table td { 
	        padding: 8px; 
	    }
	    .detail-table td:first-child { 
	        font-weight: 600; 
	        color: #495057; 
	        width: 180px; 
	    }
	    /* Custom badge colors for eG priorities */
	    .badge.bg-eg-minor {
	        background-color: #ccc100 !important;
	        color: #000 !important;
	    }
	</style>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="container">
            <h1>eG Alarm Analysis Report</h1>
            <p class="subtitle" th:text="'Generated from: ' + ${zipFileName}">Generated from: alarm_analysis.zip</p>
            <p class="subtitle" th:text="'Report Date: ' + ${reportDate}">Report Date: February 15, 2026</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- No Alarms Message -->
        <div th:if="${#lists.isEmpty(alarms)}" class="alert alert-warning">
            No alarm data found in this archive.
        </div>

        <!-- Alarm Cards -->
        <div th:each="alarm, iterStat : ${alarms}" 
             th:class="'card alarm-card priority-' + ${#strings.toLowerCase(alarm.priority)}">
            
            <!-- Card Header -->
            <div class="card-header">
                <h5 class="mb-0">
                    <span th:text="'Alarm #' + ${iterStat.count} + ': ' + ${alarm.componentName} + ' - ' + ${alarm.measure}">
                        Alarm #1: Component - Measure
                    </span>
                    <span th:if="${alarm.repeatCount > 1}" 
                          class="badge badge-repeat" 
                          th:text="'Repeated ' + ${alarm.repeatCount} + ' times'">
                        Repeated 5 times
                    </span>
                </h5>
            </div>

            <!-- Card Body -->
            <div class="card-body">
                <!-- Alarm Details Table -->
                <table class="table table-sm detail-table">
                    <tr>
                        <td>Component:</td>
                        <td th:text="${alarm.componentName}">Component Name</td>
                    </tr>
                    <tr>
                        <td>Component Type:</td>
                        <td th:text="${alarm.componentType}">Component Type</td>
                    </tr>
                    <tr>
                        <td>Test:</td>
                        <td th:text="${alarm.test}">Test Name</td>
                    </tr>
                    <tr>
                        <td>Measure:</td>
                        <td th:text="${alarm.measure}">Measure Name</td>
                    </tr>
                    <tr>
                        <td>Priority:</td>
                        <td>
                            <span th:class="'badge bg-' + ${alarm.priorityColor}" 
                                  th:text="${alarm.priority}">
                                Major
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Layer:</td>
                        <td th:text="${alarm.layer}">Layer</td>
                    </tr>
                    <tr>
                        <td>Description:</td>
                        <td th:text="${alarm.description}">Description</td>
                    </tr>
                    <tr>
                        <td>Start Time:</td>
                        <td th:text="${alarm.startTime}">Start Time</td>
                    </tr>
                    <tr>
                        <td>Duration:</td>
                        <td th:text="${alarm.duration}">Duration</td>
                    </tr>
                    <tr th:if="${alarm.info != null && alarm.info != '-'}">
                        <td>Info:</td>
                        <td th:text="${alarm.info}">Info</td>
                    </tr>
                </table>

                <!-- Metric Graph -->
                <div th:if="${alarm.measureGraphBase64 != null}">
                    <h6 class="section-title">Metric Trend</h6>
                    <img th:src="'data:image/png;base64,' + ${alarm.measureGraphBase64}" 
                         class="metric-image" 
                         alt="Metric Graph">
                </div>

                <!-- Interpretation from eG Help -->
                <h6 class="section-title">Measure Interpretation</h6>
                <div class="interpretation-box">
                    <div th:if="${alarm.interpretation != null}">
                        <strong>Description:</strong> <span th:text="${alarm.interpretationDescription}">Description</span><br>
                        <strong>Unit:</strong> <span th:text="${alarm.interpretationUnit}">Unit</span><br>
                        <strong>Interpretation:</strong> <span th:text="${alarm.interpretationText}">Interpretation</span>
                    </div>
                    <div th:unless="${alarm.interpretation != null}">
                        No interpretation data available for this test.
                    </div>
                </div>

                <!-- AI Analysis -->
                <h6 class="section-title">AI-Powered Analysis</h6>
                <div class="ai-analysis priority-' + ${#strings.toLowerCase(alarm.priority)}" th:utext="${alarm.aiAnalysis}">
                    AI analysis will appear here...
                </div>
            </div>
        </div>

        <!-- Caveat Box -->
        <div class="caveat-box">
            <h6><strong>⚠️ Important Notice</strong></h6>
            <p class="mb-0">
                This report was generated using an on-premise AI model (Ollama). 
                No data was transmitted to cloud-based LLM services. All analysis was performed locally 
                to ensure data privacy and security. The AI-powered analysis should be reviewed by 
                qualified personnel and used as a guide rather than definitive diagnosis.
            </p>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-section">
        <div class="container text-center">
            <p class="mb-1" th:text="'© ' + ${currentYear} + ' eG Innovations. All rights reserved.'">
                © 2026 eG Innovations. All rights reserved.
            </p>
            <p class="mb-0">
                <small>For more information, visit <a href="https://www.eginnovations.com" class="text-white">www.eginnovations.com</a></small>
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
